# nooLiteHub
MQTT gateway for MTRF-64 

## Топики

Топики имеют префикс "nooLiteHub/". Его можно изменить через параметры запуска. 

Все топики делятся на 3 группы: 
* nooLiteHub/recv/# - сообщения, получаемые от модуля
* nooLiteHub/sent/# - сообщения, отправленные модулю
* nooLiteHub/write/# - команды приложению

Обозначения, используемые в именах топиков:
* ":ch" - номер канала, число от 0 до 63 включительно
* ":device" - идентификатор устройства. 4 байта в hex. Например, "0000A4B3"

### Сырые сообщения

Топик | Сообщение | Описание
------------ | ------------- | ------
write/raw | [171,2,0,0,11,0,0,0,0,0,0,0,0,0,0,184,172] | Отправить модулю пакет, сформированный вручную
sent/raw | [171,2,0,0,11,0,0,0,0,0,0,0,0,0,0,184,172] | Пакет, отправленный модулю
recv/raw | [173,2,1,2,11,0,0,2,0,0,0,0,0,203,180,62,174] | Пакет, полученный от модуля 


### Силовые блоки без обратной связи

Топик | Сообщение | Описание
------------ | ------------- | ------
write/tx/:ch/bind |  | Привязать блок
write/tx/:ch/unbind |  | Отвязать блок
write/tx/:ch/power | on,off | Включить/выключить нагрузку
write/tx/:ch/on |  | Включить нагрузку
write/tx/:ch/off |  | Выключить нагрузку
write/tx/:ch/switch |  | Включить или выключить нагрузку


### Силовые блоки nooLite-F

Топик | Сообщение | Описание
------------ | ------------- | ------
write/txf/:ch/bind |  | Привязать модуль
write/txf/:ch/unbind |  | Отвязать модуль
write/txf/:ch/power | on,off | Включить/выключить нагрузку
write/txf/:ch/on |  | Включить нагрузку
write/txf/:ch/off |  | Выключить нагрузку
write/txf/:ch/switch |  | Включить или выключить нагрузку
write/txf/:ch/state |  | Запросить текущее состояние блока (включен, яркость, режим привязки)
write/txf/:ch/state0 |  | То же самое что write/txf/:ch/state
write/txf/:ch/state1 |  | Запросить текущее состояние (дополнительный вход, прием обычного nooLite)
write/txf/:ch/state2 |  | Запросить текущее состояние (количество свободных ячеек для привязки)
recv/txf/:ch/:device/state/power | off,on | Блок включен/выключен
recv/txf/:ch/:device/state/bind | false,true | Включен режим привязки
recv/txf/:ch/:device/state/brightness | 0..255 | Яркость
recv/txf/:ch/:device/state/input | off,on | Состояние дополнительного входа блока (off - разомкнут, on - замкнут)
recv/txf/:ch/:device/state/noolite_disabled_temporary | false,true | Прием nooLite временно запрещен (до перезапуска блока)
recv/txf/:ch/:device/state/noolite_disabled | false,true | Прием nooLite запрещен
recv/txf/:ch/:device/state/free_slots_noolite | 0..32 | Количество свободных ячеек для привязки nooLite
recv/txf/:ch/:device/state/free_slots_noolite_f | 0..32 | Количество свободных ячеек для привязки nooLite-F


### Пульты

Топик | Сообщение | Описание
------------ | ------------- | ------
write/rx/:ch/bind |  | Привязать выключатель
recv/rx/:ch/on | | Выключить нагрузку
recv/rx/:ch/off | | Включить нагрузку
recv/rx/:ch/switch | | Включить или выключить нагрузку
recv/rx/:ch/load_preset | | Загрузить сценарий
recv/rx/:ch/save_preset | | Сохранить сценарий
recv/rx/:ch/bright_back | | Запущено плавное изменение яркости в обратном направлении
recv/rx/:ch/stop_reg |  | Плавное изменение яркости завершено

### Сенсоры температуры и влажности

Топик | Сообщение | Описание
------------ | ------------- | ------
write/rx/:ch/bind |  | Привязать сенсор
recv/rx/:ch/temperature | 22.7 | Температура
recv/rx/:ch/humidity | 42 | Влажность
recv/rx/:ch/low_battery | false,true | Низкий уровень заряда батареи
recv/rx/:ch/device | PT111,PT112,unknown | Модель устройства

## Примеры

Везде в примерах используется число 15 в качестве номера канала, с которым производятся действия. В качестве консольного клиента MQTT используется mosquitto_pub

### Cиловой блок без обратной связи

### Силовой блок Noolite-F

**Привязать**
1. Перевести силовой блок в режим привязки
2. Послать сообщение
```
mosquitto_pub -t nooLiteHub/write/txf/15/bind -m ""
```

**Включить**
```
mosquitto_pub -t nooLiteHub/write/txf/15/on -m ""
```

**Выключить**
```
mosquitto_pub -t nooLiteHub/write/txf/15/off -m ""
```

**Переключить**
```
mosquitto_pub -t nooLiteHub/write/txf/15/switch -m ""
```

### Пульт

**Привязать**
1. Перевести модуль в режим привязки, послав сообщение
```
mosquitto_pub -t nooLiteHub/write/rx/15/bind -m ""
```
2. Перевести переключатель в режим привязки и нажать кнопку, которую нужно привязать
